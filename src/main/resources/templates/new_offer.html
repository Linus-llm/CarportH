<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title th:text="'Nyt tilbud - '+${offer.id}"></title>
    <style>
        body {
            background-color: #efefef;
        }
        .tab {
            overflow: hidden;
            border: 1px solid #ccc;
        }

        .tab-button {
            color: black;
            background-color: inherit;
            float: left;
            border: none;
            border-left: 1px solid black;
            border-right: 1px solid black;
            outline: none;
            cursor: pointer;
            padding-left: 1em;
            padding-right: 1em;
        }

        .tab-button:hover {
            background-color: #ddd;
        }

        .tab-button.active {
            background-color: white;
        }

        .tabcontent {
            display: none;
            padding: 6px 12px;
            border: 1px solid #ccc;
            border-top: none;
        }

        .frame {
            border: 1px solid #787878;
            padding: 4px;
            width: 50%;
            margin: 4px;
        }
        .frame h3 {
            margin-top: 0;
        }
        .frame-text {
            display: inline-block;
            color: grey;
            border: none;
            border-left: 2px solid black;
            border-top: 2px solid black;
            background-color: white;
        }
        .frame-table {
            position: relative;
            max-height: 200px;
            overflow-y: auto;
            margin-top: 20px;
            color: black;
            border: none;
            width: fit-content;
        }
        label {
            font-weight: bold;
            display: inline-block;
            width: 25%;
            cursor: text;
        }
        button {
            cursor: pointer;
        }
        table {
            background-color: white;
            border-spacing: 0;
            border-left: 1px solid black
            border-right: 1px solid black
        }
        th, td {
            text-align: center;
            border-spacing: 0;
            border: 1px solid grey;
            padding-left: 1em;
            padding-right: 1em;
        }
        th {
            position: sticky;
            overflow-y: visible;
            top: 0;
            z-index: 1;
            color: black;
            background-color: #efefef;
            font-weight: bold;
            border: 2px solid black;
        }
        svg {
            background: white;
        }
    </style>
</head>
<body>
    <div class="tab">
        <a id="tab-dimensions" class="tablink tab-button" onclick="openTab(event, 'dimensions')">Dimensioner</a>
        <a id="tab-matlist" class="tablink tab-button" onclick="openTab(event, 'matlist')">Stykliste</a>
        <a class="tablink tab-button" onclick="openTab(event, 'customer')">Kunde</a>
        <a class="tablink tab-button" onclick="openTab(event, 'drawing')">Tegning</a>
        <a class="tablink tab-button" onclick="openTab(event, 'offer')">Tilbud</a>
    </div>
    <p th:if="${errmsg}!=null" th:text="${errmsg}"></p>
    <div id="dimensions" class="tabcontent">
        <form method="POST" action="/sales/calc">
            <div class="frame">
                <h3>Konstrukstionsstørrelse (mtr mål)</h3>
                <label for="width">Bredde:</label>
                <input type="number" id="width" name="width" step="any" th:value="${offer.width}/1000">
                <br>
                <label for="length">Lœngde:</label>
                <input type="number" id="length" name="length" step="any" th:value="${offer.length}/1000">
                <br>
                <label for="height">Højde:</label>
                <input type="number" id="height" name="height" step="any" th:value="${offer.height}/1000">
                <br>
            </div>
            <button type="submit">Beregn stykliste --></button>
        </form>
        <div class="frame">
            <h3>Evt. bemærkning / særlige ønsker</h3>
            <div class="frame-text">
                <p th:text="${offer.text}"></p>
            </div>
        </div>
    </div>
    <div id="matlist" class="tabcontent">
        <h2>Stykliste:</h2>
        <div class="frame-table">
            <table>
                <tr>
                    <th>Antal</th>
                    <th>Nummer</th>
                    <th>Beskrivelse</th>
                    <th>Hjælpe Tekst</th>
                    <th>Længde</th>
                    <th>Bredde</th>
                    <th>Højde</th>
                </tr>
                <th:block th:each="bill:${bills}">
                    <tr>
                        <td th:text="${bill.quantity}"></td>
                        <td th:text="${bill.woodId}"></td>
                        <td style="text-align: left" th:text="${bill.width + 'x' + bill.height + 'mm. ' + @app.web.Translator@translate(bill.category)}"></td>
                        <td style="text-align: left" >TODO: helptext</td>
                        <td th:text="${bill.length}"></td>
                        <td th:text="${bill.width}"></td>
                        <td th:text="${bill.height}"></td>
                    </tr>
                </th:block>

            </table>
        </div>
        <div class="frame">
            <h3>Pris og prisforslag</h3>
            <label>Pris</label>
            <span th:text="${@app.web.Translator@currency(offer.price)}+' kr.'"></span>
            <br>
            <form method="POST" action="/sales/set-price">
                <label for="salesprice">Prisforslag ved salg</label>
                <input type="text" step="0.01" id="salesprice" name="salesprice" th:value="${@app.web.Translator@currency(offer.price)}" placeholder="Salgspris">
                <span>kr.</span>
                <br>
                <button type="submit">Sæt pris</button>
            </form>
        </div>
    </div>
    <div id="customer" class="tabcontent">
        <div class="frame">
            <h3>Kunde</h3>
            <label>Kunde nr:</label>
            <span th:text="${customer.id}"></span><br>
            <label>Navn:</label>
            <span th:text="${customer.name}"></span><br>
            <label>Email:</label>
            <span th:text="${customer.email}"></span><br>
        </div>
    </div>
    <div id="drawing" class="tabcontent">
        <p>Tegning</p>
        <div th:utext="${svg}"></div>
    </div>
    <div id="offer" class="tabcontent">
        <div class="frame">
            <h3>Konstrukstionsbeskrivelse</h3>
            <div class="frame-text">
                <span style="display:block;text-align:center;" th:text="'Tilbud nr. '+${offer.id}"></span><br>
                <span>------------------------------------</span><br>
                <span th:text="'Carport '+${offer.width}/1000+' x '+${offer.length}/1000+' mtr.'"></span><br>
                <span>------------------------------------</span><br>
                <span th:text="'Salgspris: '+${@app.web.Translator@currency(offer.price)}+' kr'"></span><br>
                <span>------------------------------------</span><br>
            </div>
        </div>
        <form method="POST" action="/sales/send-offer">
            <label for="text">Evt. bemærkning</label>
            <br>
            <textarea id="text" name="text"></textarea>
            <button type="submit">Send tilbud</button>
        </form>
    </div>
</body>
<script th:inline="javascript">
    let defaultTab = [[${defaultTab}]];
    function openTab(event, tabName) {
        var i, tabcontent, tablink;

        tabcontents = document.getElementsByClassName("tabcontent");
        for (i = 0; i < tabcontents.length; i++)
            tabcontents[i].style.display = "none";

        tablinks = document.getElementsByClassName("tablink");
        for (i = 0; i < tablinks.length; i++)
            tablinks[i].className = tablinks[i].className.replace(" active", "");

        var element = document.getElementById(tabName);
        element.style.display = "block";
        event.currentTarget.className += " active";
    }
    document.getElementById(defaultTab).click();
</script>
</html>